#!/bin/sh
#Quick script to return basic information about the system

#Project Trident Versioning
manifest="/var/db/current-manifest.json"
echo "Project Trident Information"
echo "--------------------------------------"
echo "OS Version: "$(jq -r '."os_version"' ${manifest})
time_t=`pkg query %v manifest | cut -d . -f 3-`
echo "Build Date: $(date -j -f %s ${time_t})"
echo "Boot Type: $(sysctl -n machdep.bootmethod)"
echo "--------------------------------------"
echo "TrueOS Sources Used:"
gh_org=$(jq -r '."ports"."github-org"' ${manifest})
gh_repo=$(jq -r '."ports"."github-repo"' ${manifest})
gh_tag=$(jq -r '."ports"."github-tag"' ${manifest})
echo "  Base Repository: https://github.com/trueos/trueos"
echo "  Base Commit Branch or Tag: trueos-stable-18.12-cleanbuild"
echo "  Ports Repository: https://github.com/${gh_org}/${gh_repo}"
echo "  Ports Commit Branch or Tag: ${gh_tag}"
echo "--------------------------------------"
echo "System Specs:"
echo "  Boot Method: $(sysctl -n machdep.bootmethod)"
echo "  $(sysctl -n hw.model)"
echo "  Physical CPUs: $(sysctl -n hw.ncpu)"
phys_mem=$(sysctl -n hw.physmem)
phys_mem=`bc -e scale=2 -e ${phys_mem}/1073741824 -e quit`
echo "  Physical Memory: ${phys_mem} GB"
#echo "--------------------------------------"
#Now detect the current GPU Driver
# To-Do : /etc/X11/xorg.conf : /usr/local/etc/X11/xorg.conf : /usr/local/etc/X11/xorg.fallback.conf
echo "--------------------------------------"
#Now get some GPU information
echo "GPU Information:"
num_gpus=`pciconf -l | grep vgapci | wc -l`
for i in `jot ${num_gpus} 0`
do
  echo "  $(pciconf -lv vgapci${i})"
done
echo "--------------------------------------"
echo "Network Device Information"
for i in $(ifconfig -l ether) $(sysctl -n net.wlan.devices)
do
  tmp=$(pciconf -lv ${i} 2>/dev/null)
  if [ $? -eq 0 ] ; then
    echo "  ${tmp}"
  fi
done
